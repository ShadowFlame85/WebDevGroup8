@using WebMatrix.Data
@{
    /**/

    Page.Title = "Antelope Canyon";
    Layout = "~/Layout/_LayoutStoryPage.cshtml";
}
@{
    string connectionString = @"Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\Bezoekers.mdf;Integrated Security=True";
    string provider = "System.Data.SqlClient";
    Database db = Database.OpenConnectionString(connectionString, provider);


    var comment = "";

    var Story_Id = 2;
    DateTime datum;
    var userId = Session["ID"];

    if (IsPost)
    {
        if (Request.Form["commentButton"] != null && userId != null)
        {



            comment = Request.Form["comment"];
            datum = DateTime.Now;
            var insertCommand = "INSERT INTO Comments (Datum, Comment, Registratie_Id, Story_Id) Values(@0, @1, @2, @3)";
            db.Execute(insertCommand, datum, comment, userId, Story_Id);
            Response.Redirect("~/Stories/" + Story_Id + ".cshtml");
        }
    }
    List<string> fotolijst = new List<string>();
    var fotos = db.Query("SELECT ImageURL  FROM Images WHERE Story_Id=@0 ", Story_Id);
    foreach (var row in fotos)
    {
        fotolijst.Add(row.ImageURL);
    }
}
<main>
    <div id="background">
        <div id="empty"></div>
        <div class="container">
            <div class="ombouw">
                <h1>Antelope Canyon (Arizona) </h1>
                <p>
                    De Antelope Canyon werd in het jaar 1931 ontdekt door de Navajo indianen. Antelope Canyon is een zogenaamde slot canyon bij de plaats Page in de Amerikaanse staat Arizona. Een slot canyon is het beste te omschrijven als een diepe geul met een door stormvloedwater uitgeslepen spleet erin, waar wij als mensen nu doorheen kunnen lopen. In Nederland wordt Antelope Canyon vaak fout gespeld als "Antilope Canyon".
                    <br /><br />
                    Het gebied wordt onderverdeeld in twee locaties: Upper Antelope Canyon en Lower Antelope Canyon, waarvoor allebei apart toegang betaald moet worden. Wij hebben de Lower Canyon bezocht waarbij je gebruik moet maken van trappen. De Lower Canyon is makkelijker toegankelijk, echter hiervoor waren geen toegangskaartjes meer beschikbaar.
                    <br /><br />
                    Het is verplicht om een gids te huren als je Antelope Canyon bezoekt, zowel voor de Upper als de Lower Canyon. Je kunt de kaartjes (ca. € 60,00 p.p.) hiervoor ter plekke kopen, maar makkelijker is het om vooraf een rondleiding te reserveren in Page. De gidsen zijn afstammelingen van de Navajo-indianen. Er wordt veel verteld over het ontstaan van de Antelope Canyon en de cultuur de Indianen en in het bijzonder over de Navajo-stam.
                </p>
            </div>
        </div>
        <div class="container">
            <div class="row bootstrap snippets">
                <div class="col-md-3"></div>
                <div class="col-md-6">
                    <div class="comment-wrapper">
                        <div class="panel panel-info ombouw2">
                            <div class="panel-heading">
                                <h3>Reacties</h3>
                            </div>
                            <div class="panel-body">

                                <br>
                                @if (userId != null)
                                {
                                    <form method="post">
                                        <textarea name="comment" class="form-control" placeholder="write a comment..." rows="3"></textarea>
                                        <button name="commentButton" type="submit" class="btn btn-info pull-right">Post</button>
                                    </form>
                                }
                                else
                                {
                                    <textarea name="comment" class="form-control" placeholder="U moet ingelogd zijn voordat u een comment kunt plaatsen" rows="3" disabled></textarea>
                                    // <button name="commentButton" type="button" class="btn btn-info pull-right" disabled>Post</button>
                                }
                                <div class="clearfix"></div>
                                <hr>
                                <ul class="media-list">
                                    @{
                                        var query = db.Query("SELECT Comments.Datum, Registratie.Gebruikersnaam, Comments.Comment  FROM [Comments] JOIN Registratie ON [Comments].Registratie_Id = Registratie.Id WHERE Story_Id=@0 ORDER BY Comments.Datum DESC", Story_Id);
                                        foreach (var row in query)
                                        {


                                            <li class="media">
                                                <div class="media-body">
                                                    <span class="text-muted pull-right">
                                                        <small class="text-muted">@row.Datum</small>
                                                    </span>
                                                    <strong class="text-success">@row.Gebruikersnaam</strong>
                                                    <p>
                                                        @row.Comment
                                                    </p>
                                                </div>
                                            </li>
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-md-3"></div>
            </div>

        </div>
    </div>
</main>
}