@using WebMatrix.Data
@{
    /**/

    Page.Title = "Yosemite National Park";
    Layout = "~/Layout/_LayoutStoryPage.cshtml";
}
@{
    string connectionString = @"Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\Bezoekers.mdf;Integrated Security=True";
    string provider = "System.Data.SqlClient";
    Database db = Database.OpenConnectionString(connectionString, provider);


    var comment = "";

    var Story_Id = 10;
    DateTime datum;
    var userId = Session["ID"];

    if (IsPost)
    {
        if (Request.Form["commentButton"] != null && userId != null)
        {



            comment = Request.Form["comment"];
            datum = DateTime.Now;
            var insertCommand = "INSERT INTO Comments (Datum, Comment, Registratie_Id, Story_Id) Values(@0, @1, @2, @3)";
            db.Execute(insertCommand, datum, comment, userId, Story_Id);
            Response.Redirect("~/Stories/" + Story_Id + ".cshtml");
        }
    }
    List<string> fotolijst = new List<string>();
    var fotos = db.Query("SELECT ImageURL  FROM Images WHERE Story_Id=@0 ", Story_Id);
    foreach (var row in fotos)
    {
        fotolijst.Add(row.ImageURL);
    }
}
<main>
    <div id="background">
        <div id="empty"></div>
        <div class="container">
            <div class="ombouw">
                <h1>Yosemite National Park (Californië)</h1>
                <p>
                    Dit is een prachtig uitgestrekt landschap door gletchers gevormd gebied. Hier kun je prachtig wandelen en zie je spectaculaire uitzichten met o.a. watervallen. In mirror lake kun je baden. In 1993 ben ik ook hier geweest en kon je zien waarom deze lake mirror heet, je hebt namelijk de spiegeling van het landschap in het meer. Echter in 2017 was het zo droog geweest dat het meer bijna droog lag en de spiegeling minder goed te zien was. <br />
                    Vanaf Glacier Point heb je een prachtig uitzicht over de vallei en zie je de Half Dome en Yosemite Falls. Dit punt is via de auto te bereiken, maar let op in het hoog seizoen, dan wordt je in bussen vanaf een groot parkeerplaats vervoerd. De wachttijden kunnen dan lang zijn.
                </p>
            </div>
        </div>
        <div class="container">
            <div class="row bootstrap snippets">
                <div class="col-md-3"></div>
                <div class="col-md-6">
                    <div class="comment-wrapper">
                        <div class="panel panel-info ombouw2">
                            <div class="panel-heading">
                                <h3>Reacties</h3>
                            </div>
                            <div class="panel-body">

                                <br>
                                @if (userId != null)
                                {
                                    <form method="post">
                                        <textarea name="comment" class="form-control" placeholder="write a comment..." rows="3"></textarea>
                                        <button name="commentButton" type="submit" class="btn btn-info pull-right">Post</button>
                                    </form>
                                }
                                else
                                {
                                    <textarea name="comment" class="form-control" placeholder="U moet ingelogd zijn voordat u een comment kunt plaatsen" rows="3" disabled></textarea>
                                    // <button name="commentButton" type="button" class="btn btn-info pull-right" disabled>Post</button>
                                }
                                <div class="clearfix"></div>
                                <hr>
                                <ul class="media-list">
                                    @{
                                        var query = db.Query("SELECT Comments.Datum, Registratie.Gebruikersnaam, Comments.Comment  FROM [Comments] JOIN Registratie ON [Comments].Registratie_Id = Registratie.Id WHERE Story_Id=@0 ORDER BY Comments.Datum DESC", Story_Id);
                                        foreach (var row in query)
                                        {


                                            <li class="media">
                                                <div class="media-body">
                                                    <span class="text-muted pull-right">
                                                        <small class="text-muted">@row.Datum</small>
                                                    </span>
                                                    <strong class="text-success">@row.Gebruikersnaam</strong>
                                                    <p>
                                                        @row.Comment
                                                    </p>
                                                </div>
                                            </li>
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-md-3"></div>
            </div>

        </div>
    </div>
</main>
}